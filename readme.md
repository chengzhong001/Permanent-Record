# 爱德华·斯诺登《永久档案》PDF书签生成器

本Python脚本读取爱德华·斯诺登《永久档案》的中文译本（永久档案原始.pdf），提取目录和章节标题，并为PDF添加书签，方便阅读和导航。输出的新PDF文件包含已添加的书签。

## 功能特性

- 自动创建书签：提取部分标题、章节标题和其他重要标题，自动生成书签。
- 层次结构：在书签中保持部分和章节的父子关系。
- 可定制的模式匹配：使用正则表达式在文本中查找模式，可根据不同的PDF进行修改。
- 文本输出：将书签及其对应的页码写入book_marks.txt文件，方便参考。

## 环境要求

- Python 3.x
- pypdf 库：用于读取和写入PDF文件。
- 正则表达式模块 (re)：用于文本提取中的模式匹配。


## 安装

使用 pip 安装所需的Python库：

```bash
pip install pypdf
```
## 使用方法

1. 准备PDF文件：
   - 将原始PDF文件（永久档案原始.pdf）放置在doc目录下。
2. 运行脚本：
   - 执行Python脚本：

```bash
python main.py
```
- 脚本将处理PDF并在doc目录下生成包含书签的新文件（永久档案（爱德华·斯诺登）.pdf）。
- 同时会创建一个book_marks.txt文件，包含书签及其页码信息。

1. 脚本将生成：
   - 一个带有书签的新 PDF 文件，保存在指定的输出路径
   - 一个 book_marks.txt 文件，包含提取的书签信息

## 工作原理

工作原理

1. 设置文件路径

脚本定义了输入和输出文件的路径：
```python
input_pdf_path = "doc/永久档案原始.pdf"
output_pdf_path = "doc/永久档案（爱德华·斯诺登）.pdf"
```
2. 读取PDF文件

   - 使用 PdfReader 读取输入的PDF文件。
   - 初始化一个字典 book_marks_dict 用于存储书签信息。

3. 提取文本并识别书签
- 遍历PDF的每一页。
- 使用 extract_text() 提取文本内容。
- 使用正则表达式搜索特定模式：
  - 目录：查找 "EDWARD Contents 目 录"。
  - 前言：匹配 "前 言"。
  - 部分：匹配类似 "PartOne 第一部"、"PartTwo 第二部" 的模式。
```python
pattern = r"Part(?:One|Two|Three)\s+第[一二三四五六七八九十]+部"
```

- 章节：匹配类似 "第X章 章标题" 的模式。
```python
pattern = r"\s{15,}第[一二三四五六七八九十百千]+章\s+[\u4e00-\u9fff]+"
```
- 致谢：查找 "致 谢"。

  - 将找到的书签及其页码存储在 book_marks_dict 中。
  - 将书签写入 book_marks.txt，便于验证。


4. 写入包含书签的新PDF

	•	创建一个新的 PdfWriter 实例。
	•	将原PDF的所有页面复制到新的写入器中。
	•	使用 add_outline_item() 向写入器添加书签：
	•	为部分和章节添加父级书签。
	•	在对应的部分下添加章节的子级书签。
	•	将新的PDF写入 output_pdf_path。

5. 输出信息

- 在控制台打印进度消息，指示哪些书签已添加及其页码。
- 当书签成功添加后，确认完成。

## 自定义

- 调整正则表达式：
  - 修改 pattern 变量以匹配不同PDF的格式。
- 更改输入/输出路径：
  - 更新 input_pdf_path 和 output_pdf_path 为所需的文件位置。
- 添加更多模式：
  - 包括其他部分如附录或引言的匹配模式。

## 注意事项

- 脚本假定PDF的文本是可提取的。如果PDF是未经OCR处理的扫描图像，文本提取将无法工作。
- 正则表达式是针对特定PDF的格式设计的，可能需要根据其他PDF进行调整。
- 确保 doc 目录存在并与脚本位于同一目录下。

疑难解答

- 未添加书签：
  - 确认PDF中的文本模式与正则表达式匹配。
  - 尝试手动选择文本，检查PDF文本是否可提取。
- 执行期间出错：
  - 确保已安装所有依赖项（pypdf）。
  - 检查文件路径和权限。
- 页码不正确：
  - 脚本中的页码从零开始。根据需要调整 page_num。

## 示例输出

执行期间控制台的示例输出：

```
目录页码: 5
前言页码: 10
章节页码: 25, 章节标题: 第一部
  子章节页码: 26, 子章节标题: 第1章 起点
...
致谢页码: 320
开始添加书签
书签已成功添加到 doc/永久档案（爱德华·斯诺登）.pdf
```
## 许可证

本脚本是开源的，可自由使用。您可以根据需要进行修改。
